% Optimizado para compilación rápida
\documentclass[paper=letter, fontsize=11pt, draft=false]{scrartcl}

% Modifications to layout
\usepackage[shortlabels]{enumitem} % Incisos
\def\code#1{\texttt{#1}} % \code{} for monospaced text
\newcommand{\RNum}[1]{\footnotesize\uppercase\expandafter{\romannumeral #1\relax\normalsize}} % Roman numbers

\usepackage{subcaption} % 2x2 graphs
\usepackage{mwe}
\usepackage{float} % [H] in graphics
\usepackage[hidelinks]{hyperref}  % Hipervínculos en la TOC

\usepackage{booktabs,siunitx,listings}
\usepackage[most]{tcolorbox}
\tcbuselibrary{theorems}
\usepackage{cleveref}

% Typography and layout packages
\usepackage{graphicx}
\usepackage{verbatim}
% \usepackage{xcolor}
\usepackage[spanish,es-nodecimaldot]{babel} % Language and hyphenation
\usepackage{amsmath, amsfonts, amsthm, amssymb} % Math packages
\newtheorem{definition}{Definición} % definition
\usepackage{fancyvrb}
\usepackage{sectsty} % Customize section commands
\usepackage{geometry} % Modify margins
\usepackage{titlesec} % Customize section titles
\geometry{margin=3cm,top=2.5cm,bottom=2.5cm} % Simplified geometry
\allsectionsfont{\centering \normalfont\scshape} % Center and style section titles

% Header and footer customization
\usepackage{fancyhdr}
\pagestyle{fancyplain}
\fancyhead[L]{\slshape} % Remove section title from header
\fancyhead[C]{} % Header center
\fancyhead[R]{\thepage} % Header right with page number
\fancyfoot[L]{} % Footer left
\fancyfoot[C]{} % Footer center
\fancyfoot[R]{\small \slshape Gustavo Hernández Angeles} % Footer right
\renewcommand{\headrulewidth}{0.4pt} % Header rule
\renewcommand{\footrulewidth}{0.4pt} % Footer rule
\setlength{\headheight}{14.5pt} % Header height

% Paragraph settings
\setlength\parindent{0pt}
\setlength{\parskip}{1ex}

% Section spacing
\titlespacing*{\section}{0cm}{0.50cm}{0.25cm}

% --- Theorems, lemma, corollary, postulate, definition ---
\definecolor{Pantone209C}{HTML}{64293e}

\newcounter{problemcounter}

\numberwithin{equation}{problemcounter} % Number equations within problems
\numberwithin{figure}{problemcounter} % Number figures within problems
\numberwithin{table}{problemcounter} % Number tables within problems
\numberwithin{subsection}{problemcounter} 

\newtcbtheorem[auto counter]{problem}{Ejercicio}{
    enhanced,
    breakable,
    colback = gray!5,
    colframe = gray!5,
    boxrule = 0.5pt,
    sharp corners,
    borderline west = {2mm}{0mm}{Pantone209C},
    fonttitle = \bfseries\sffamily,
    coltitle = Pantone209C,
    drop fuzzy shadow,
    parbox = false,
    before skip = 3ex,
    after skip = 3ex
}{problem}
\makeatletter
\renewenvironment{problem}[2][]{%
    \refstepcounter{problemcounter}%
    \addcontentsline{toc}{section}{\protect\numberline{\theproblemcounter}Ejercicio \theproblemcounter: #2}%
    \begin{tcolorbox}[
        enhanced,
        breakable,
        colback = gray!5,
        colframe = gray!5,
        boxrule = 0.5pt,
        sharp corners,
        borderline west = {2mm}{0mm}{Pantone209C},
        fonttitle = \bfseries\sffamily,
        coltitle = Pantone209C,
        drop fuzzy shadow,
        parbox = false,
        before skip = 3ex,
        after skip = 3ex,
        title={Ejercicio \theproblemcounter: #2}
    ]
}{%
    \end{tcolorbox}
}
\makeatother

\tcbuselibrary{skins, breakable}
% Custom command for a horizontal rule
\newcommand{\horrule}[1]{\rule{\linewidth}{#1}} 

% Custom section titles with numbering
\titleformat{\section}
{\normalfont\Large\bfseries}{\thesection}{1em}{}

\titleformat{\subsection}
{\normalfont\large\bfseries}{\thesubsection}{1em}{}

\titleformat{\subsubsection}
{\normalfont\normalsize\bfseries}{\thesubsubsection}{1em}{}

% Title and author
\title{	
    \begin{center}
        \includegraphics[width=3cm]{figure/template/cimat-logo.png} % Adjust size as needed
    \end{center}
    \vspace{0.5cm}
    \normalfont \normalsize 
    \textbf{\Large   Centro de Investigación en Matemáticas} \\
    \Large Unidad Monterrey \\ [25pt] 
    \horrule{1pt} \\[0.4cm] % Thin top horizontal rule
    \huge Análisis Multimodal\\
    \Large Tarea 2\\ 
    \horrule{2pt} \\[0.5cm] % Thick bottom horizontal rule
}

\author{\large Gustavo Hernández Angeles}    

\date{\normalsize\today} % Today's date

\begin{document}
\maketitle % Print the title
\thispagestyle{empty}
\newpage

\tableofcontents
\newpage



%%%%%%%%%%% PROBLEMA 1 %%%%%%%%%%%
\begin{problem}{}
En la clase vimos cómo obtener las frecuencias centrales (en Hz) de diferentes notas o tonalidades. Calcula éstas frecuencias para todas las notas de la escala Do mayor (Figura \ref{fig:do_mayor}) y Do menor (Figura \ref{fig:do_menor}).

\begin{center}
    \begin{minipage}{0.45\textwidth}
        \centering
        \includegraphics[width=\linewidth]{figure/p1_figuraA.png}
        \par\vspace{0.2\baselineskip}
        \small (a)
        \label{fig:do_mayor}
    \end{minipage}
    \hfill
    \begin{minipage}{0.45\textwidth}
        \centering
        \includegraphics[width=\linewidth]{figure/p1_figuraB.png}
        \par\vspace{0.2\baselineskip}
        \small (b)
        \label{fig:do_menor}
    \end{minipage}
    
    \vspace{0.5\baselineskip}
    \captionof{figure}{(a) Escala C-Mayor. (b) Escala C-Menor. Ambas iniciando en C4.}
    \label{fig:escalas}
\end{center}

\end{problem}



\subsection{Inciso a): Escala C-Mayor}

El patrón de intervalos a partir de la tónica es: Tono, Tono, Semitono, Tono, Tono, Tono, Semitono. Recordando que C4 tiene un número MIDI de 60, podemos obtener los números MIDI de las notas en la escala C-Mayor haciendo saltos según el patrón de intervalos (2 para tonos y 1 para semitonos), por lo que la secuencia resultante en números MIDI sería 60, 62, 64, 65, 67, 69, 71, 72. 

Luego, utilizando la fórmula para calcular la frecuencia de una nota a partir de su número MIDI (Eq. \ref{eq:midi_to_freq}), podemos obtener las frecuencias de las notas en la escala C-Mayor (Tabla \ref{tab:freq_c_major}). Aquí notamos que la nota A4 (N. MIDI 69) tiene una frecuencia de 440 Hz, que es el estándar de afinación.

\begin{equation}
    F(p) = 440 \times 2^{\frac{(p - 69)}{12}}
    \label{eq:midi_to_freq}
\end{equation}

\begin{table}[h]
\centering
\begin{tabular}{|l|c|r|}
\hline
\textbf{Nota} & \textbf{N. MIDI (p)} & \textbf{Freq. (Hz)} \\ \hline
C4            & 60                   & $\approx 261.63$         \\
D4            & 62                   & $\approx 293.66$         \\
E4            & 64                   & $\approx 329.63$         \\
F4            & 65                   & $\approx 349.23$         \\
G4            & 67                   & $\approx 392.00$         \\
A4            & 69                   & $440.00$                 \\
B4            & 71                   & $\approx 493.88$         \\
C5            & 72                   & $\approx 523.25$         \\ \hline
\end{tabular}
\caption{Frecuencias de la Escala Do Mayor (C-Mayor) usando números MIDI.}
\label{tab:freq_c_major}
\end{table}

\newpage
\subsection{Inciso b): Escala C-Menor}

En la escala C-Menor, el patrón de intervalos a partir de la tónica es: Tono, Semitono, Tono, Tono, Semitono, Tono, Tono, obteniendo la secuencia 60, 62, 63, 65, 67, 68, 70, 72, en números MIDI. Siguiendo el mismo procedimiento que en el inciso anterior, podemos obtener los números MIDI y las frecuencias correspondientes para las notas en la escala C-Menor (Tabla \ref{tab:freq_c_minor}). Notamos que la nota Ab4 (N. MIDI 68) tiene una frecuencia de aproximadamente 415.30 Hz, que es un semitono por debajo de A4 (440 Hz), por lo que es consistente con la estructura de la escala menor.

\begin{table}[H]
    \centering
    \begin{tabular}{|l|c|r|}
    \hline
    \textbf{Nota} & \textbf{N. MIDI (p)} & \textbf{Freq. (Hz)} \\ \hline
    C4            & 60                   & $\approx 261.63$         \\
    D4            & 62                   & $\approx 293.66$         \\
    Eb4           & 63                   & $\approx 311.13$         \\
    F4            & 65                   & $\approx 349.23$         \\
    G4            & 67                   & $\approx 392.00$         \\
    Ab4           & 68                   & $\approx 415.30$         \\
    Bb4           & 70                   & $\approx 466.16$         \\
    C5            & 72                   & $\approx 523.25$         \\

    \hline
\end{tabular}
\caption{Frecuencias de la Escala Do Menor (C-Menor) usando números MIDI.}
\label{tab:freq_c_minor}
\end{table}









%%%%%%%%%%% PROBLEMA 2 %%%%%%%%%%%
\newpage
\begin{problem}{}
La Figura \ref{fig:p2_redaccion} muestra la forma de onda de un audio de los primeros 8 segundos de la quinta sinfonía de Beethoven (puedes en el extracto en formato mp3 en el moodle).

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{figure/p2_redaccion.png}
    \caption{Partitura con los primeros cinco compases de la Sinfonía No. 5 de Beethoven, y su correspondiente señal, como forma de onda, que abarca los primeros 8 segundos.}
    \label{fig:p2_redaccion}
\end{figure}

\begin{enumerate}[a)]
    \item Estima la frecuencia fundamental del sonido registrado en la sección que abarca del segundo 7.3 al 7.8, contando el número de ciclos de oscilación.
    \item Determina a qué nota músical corresponde como lo vimos en clase, es decir, buscando aquella nota cuya frecuencia fundamental es más cercana a la que estimaste en el inciso anterior. ¿Tiene sentido según la partitura mostrada en la figura \ref{fig:p2_redaccion}?
\end{enumerate}


\end{problem}



\subsection{Inciso a)}

Al inspeccionar la forma de onda ampliada para el intervalo $t \in [7.3, 7.8]$ segundos, se puede realizar un conteo visual de los ciclos de oscilación. En esta ventana de tiempo, cuya duración es $\Delta t = 7.8 \text{ s} - 7.3 \text{ s} = 0.5 \text{ s}$, se observan aproximadamente $N = 36.5$ ciclos.

La frecuencia fundamental $f_0$ se estima como la cantidad de ciclos por unidad de tiempo:

\begin{equation}
    f_0 = \frac{N \text{ ciclos}}{\Delta t \text{ (s)}} = \frac{36.5 \text{ ciclos}}{0.5 \text{ s}} = 73 \text{ Hz}
\end{equation}

La frecuencia fundamental estimada es, por lo tanto, $f_0 \approx 73 \text{ Hz}$.

\subsection{Inciso b)}

Para identificar la nota musical correspondiente a $f_0 \approx 73 \text{ Hz}$, la comparamos con las frecuencias estándar del temperamento igual (con afinación $A_4 = 440 \text{ Hz}$). La frecuencia teórica de la nota $D_2$ (Re 2) es $f_{D_2} \approx 73.42 \text{ Hz}$, siendo esta la nota cuya frecuencia fundamental es más cercana a nuestra estimación.

El segmento de audio analizado ($t \in [7.3, 7.8]$ s) corresponde al decaimiento del último acorde mostrado, el cual se ubica en el quinto compás y está marcado con un calderón.

\begin{itemize}

\item En el pentagrama superior (Clave de Sol): La nota es $D_4$ (Re 4).

\item En el pentagrama inferior (Clave de Fa): Las notas son $D_2$ (Re 2) y $D_3$ (Re 3).

\end{itemize}

La frecuencia fundamental $f_0$ de un sonido complejo generalmente corresponde a la frecuencia de la nota más grave que lo compone. Las otras notas presentes en el acorde, $D_3$ y $D_4$, son octavas de $D_2$. Sus frecuencias teóricas ($f_{D_3} \approx 146.8 \text{ Hz}$ y $f_{D_4} \approx 293.6 \text{ Hz}$) son múltiplos enteros (armónicos) de la frecuencia de $D_2$ ($f_{D_3} \approx 2 \times f_{D_2}$; $f_{D_4} \approx 4 \times f_{D_2}$).

Por lo tanto, \textbf{si tiene sentido} que la frecuencia fundamental estimada ($f_0 \approx 73 \text{ Hz}$) corresponda a la nota $D_2$ (Re 2), ya que esta es la nota más grave del acorde tocado en el compás 5, que es el segmento de audio analizado.


%%%%%%%%%%% PROBLEMA 4 %%%%%%%%%%%
\newpage
\begin{problem}{}
    Definimos $f: \mathbb{R} \to \Gamma$ como la función de cuantización de una señal continua a un conjunto de valores discretos $\Gamma \in \mathbb{R}$. La función $f$ más simple es la cuantización uniforme, donde asigna un valor de amplitud $a\in\mathbb{R}$, un valor cuantizado mediante:
    \begin{equation}
        f(a) = \text{sign}(a) \Delta \left\lfloor \frac{|a|}{\Delta}+ \frac{1}{2} \right\rfloor
        \label{eq:cuantizacion_uniforme}
    \end{equation}

    donde $\Delta$ es el tamaño del paso de cuantización, y $\lfloor \cdot \rfloor$ es la función piso. La diferencia entre la señal original y la señal cuantizada se conoce como \textbf{error de cuantización}. Muchas veces es más conveniente definir los niveles de cuantización $\lambda$ en un rango limitado de amplitud $[-a_{\text{min}}, a_{\text{max}}]$, en lugar del tamaño de paso $\Delta$. En este caso,
    $\Delta = \frac{|a_{\text{max}} - a_{\text{min}}|}{\lambda - 1}$.

    \begin{enumerate}[a)]
        \item Escribe una función que implementa la cuantización uniforme (Eq. \ref{eq:cuantizacion_uniforme}).
        \item Obtén la gráfica de la cuantización para $a = g(x;\theta)\in \mathbb{R}$, con $g$ la función lineal y una sinusoidal con los parámetros vistos en clase. Gráfica también el error absoluto de cuantización correspondiente.
        \item Con el proceso de cuantización, la señal se codifica en alguno de los $\lambda=2^b$ valores de amplitud igualmente espaciados en el intervalo definido, donde cada intervalo es de tamaño $\Delta$. El parámetro $b$ es el número de bits necesario para codificar la señal, y puede obtenerse mediante $b = \log_2(\lambda)$. Aunque es posible definir cualquier número de niveles de cuantización para la codificación, es muy común definirlos mediante el número de bits, por ejemplo 8 bits (256 niveles), 16 bits (65,536 niveles), etc. Para tener una referencia, el sonido en un CD está codificado generalmente con una cuantización de 16 bits. Realiza la cuantización uniforme de alguna(s) señal(es) de audio que se encuentran en la plataforma usando 8, 6, 4 y 2 bits. ¿Qué puedes notar en la señal con las diferentes cuantizaciones?
    \end{enumerate}
\end{problem}



\subsection{Inciso a)}
En Python, la función para implementar la cuantización uniforme según la ecuación \ref{eq:cuantizacion_uniforme} puede ser escrita de la siguiente manera:
\begin{verbatim}
    def f(a:float,
      delta:float) -> float:
    return np.sign(a) * delta * np.floor(np.abs(a)/delta + 0.5)
\end{verbatim}

En donde se hace uso de la librería NumPy para las operaciones matemáticas.


\subsection{Inciso b)}

\textbf{Función lineal}

Para la función lineal, podemos definir $g(x; \theta) = mx + c$, donde $m$ es la pendiente y $c$ es la intersección con el eje y. Por ejemplo, podemos tomar $m = 2$ y $c = 1$. 

En la figura \ref{fig:lineal} se muestra la señal original y su versión cuantizada (con $\Delta = 1$), así como una gráfica para el error absoluto de cuantización. 

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.8\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figure/lineal_cuantizada.pdf}
        \caption{}
        \label{fig:lineal_a}
    \end{subfigure}
    \vspace{0.5cm}
    \begin{subfigure}[b]{0.8\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figure/lineal_cuantizada_error.pdf}
        \caption{}
        \label{fig:lineal_b}
    \end{subfigure}
    \caption{(a) Cuantización de una función lineal y (b) su error absoluto de cuantización.}
    \label{fig:lineal}
\end{figure}

Podemos observar que la señal cuantizada aproxima la señal original, pero con saltos discretos, cuya resolución depende del valor de $\Delta$. El error absoluto de cuantización muestra cómo la diferencia oscila entre 0 y $\Delta/2 = 0.5$ de forma lineal, lo cual es esperado.


\begin{figure}
    \centering
    \begin{subfigure}[b]{0.8\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figure/sinusoidal_cuantizada.pdf}
        \caption{}
        \label{fig:sinusoidal_a}
    \end{subfigure}
    \vspace{0.5cm}
    \begin{subfigure}[b]{0.8\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figure/sinusoidal_cuantizada_error.pdf}
        \caption{}
        \label{fig:sinusoidal_b}
    \end{subfigure}
    \caption{(a) Cuantización de una función sinusoidal y (b) su error absoluto de cuantización.}
    \label{fig:sinusoidal}
\end{figure}

\textbf{Función sinusoidal}

En la figura \ref{fig:sinusoidal} se muestra la señal original y su versión cuantizada (con $\Delta = 0.5$), así como una gráfica para el error absoluto de cuantización. En este caso utilizamos la función sinusoidal $g(x; \theta) = \sin(x)$. Aquí también podemos observar que la señal cuantizada aproxima la señal original. El error absoluto de cuantización muestra un patrón periódico, oscilando entre 0 y $\Delta/2 = 0.25$, lo cual es consistente con la naturaleza periódica de la señal original. Observamos un patrón de error similar al lineal para las regiones entre picos y valles, mientras que en los picos y valles muestra una gráfica en forma de ``U''.





\subsection{Inciso c)}
En este problema se implementaron dos funciones principales: una para obtener el valor de $\Delta$ (\texttt{obtener\_delta}) basado en el número de bits y la señal original haciendo uso de la fórmula propuesta $$\Delta = \frac{a_{max}-a_{min}}{\lambda-1}$$, y la segunda (\texttt{obtener\_cuantizada}) para realizar la cuantización uniforme de una señal de audio dada la ruta del archivo y el número de bits $b$.

Nos enfocaremos en el archivo de audio \texttt{major.wav} para ilustrar los resultados obtenidos con diferentes niveles de cuantización (8, 6, 4 y 2 bits). Este archivo de audio contiene una señal musical con dos canales, lo cual es importante a considerar al momento de la cuantización. En nuestro caso, se trabajó eligiendo el $\Delta$ basado en ambos canales, es decir, se consideró un valor máximo $a_{max}$ de la señal y mínimo global $a_{min}$ para ambos canales al calcular $\Delta$, con la finalidad de mantener las amplitudes relativas entre los canales. Para las gráficas, se seleccionó un segmento de la señal para una mejor visualización (2s a 2.005s) y el canal izquierdo.

En la figura \ref{fig:major} se muestran las gráficas de la señal original y las señales cuantizadas para cada nivel de bits, junto con sus respectivos errores absolutos de cuantización. Observamos que los errores de cuantización disminuyen conforme aumenta el número de bits, lo cual es consistente con la teoría de cuantización; a medida que se incrementa el número de bits, la resolución de la cuantización mejora (dado por $\lambda = 2^b$), resultando en una aproximación más precisa de la señal original. La gráfica de las señales (Figura \ref{fig:major_a}) muestra cómo la señal cuantizada se acerca más a la señal original a medida que aumentamos el número de bits.

El caso extremo de 2 bits muestra una señal muy distorsionada, mostrando solo capacidad para representar 3 niveles de intensidad en el segmento analizado, lo cual resulta en una pérdida significativa de información y calidad sonora. Mientras que la cuantización con 8 bits ofrece una representación mucho más fiel de la señal original, con un error de cuantización considerablemente menor, casi nulo.

En cuanto a calidad de sonido, destaco que no cuento con equipo de audio decente para el análisis y sin embargo, las diferencias son muy notorias. La cuantización con 8 bits suena bastante similar a la señal original, resultándome imperceptible la diferencia. A partir de la cuantización con 6 bits, se empieza a notar severamente la pérdida de calidad, con un sonido más áspero y con la introducción de ruido. Las cuantizaciones con 4 y 2 bits resultan en una calidad de sonido muy pobre, con distorsiones graves y pérdida de detalles musicales, haciendo que la música sea prácticamente irreconocible en el caso de 2 bits (además de que suena muy fuerte, quizá dañe bocinas).


\begin{figure}
    \centering
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figure/major_cuantizada_all.pdf}
        \caption{}
        \label{fig:major_a}
    \end{subfigure}
    \vspace{0.5cm}
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figure/major_error_cuantizacion_all.pdf}
        \caption{}
        \label{fig:major_b}
    \end{subfigure}
    \caption{(a) Cuantización de la señal musical \textit{major.wav} y (b) su error absoluto de cuantización. Ambas gráficas muestran las señales cuantizadas para 8, 6, 4 y 2 bits para el canal izquierdo.}
    \label{fig:major}
\end{figure}













\newpage
\begin{problem}{}
    Los datos de la carpeta \texttt{midi\_selected} contiene archivos \texttt{midi} de diferentes obras de 8 compositores. Aunque la música se compone de diversos elementos, en éste ejercicio consideraremos sólo 3: notas, acordes y silencios. La función \texttt{get\_all\_notes} del script \texttt{fun.py} extrae los acordes, notas y silencios (con su respectiva duración), de los archivos \texttt{midi}.

    \begin{enumerate}[a)]
        \item Crea un corpus de las obras musicales de todos los compositores. Considera como variable dependiente $y$ al compositor, y crea conjuntos de entrenamiento y prueba estratificado por ésta variable de respuesta. ¿Cómo es la distrbución de las obras por compositor? Usa algunos gráficos informativos de las características del corpus.
        \item Usando una representación TF-IDF del corpus, implementa al menos 3 clasificadores para estimar $y$. Utiliza algún método eficiente para el ajuste de los modelos, asegurando una buena generalización. Elabora un resúmen breve de tus resultados incluyendo todas las métricas de desempeño, los criterios usados para la representación del corpus, el ajuste de los modelos, tus hallazgos, y demás información que creas pertinente. ¿Qué mejoras sugieres para tener un mejor resultado?
    \end{enumerate}
\end{problem}



\subsection{Inciso a)}

\textbf{Crear el corpus} fue sencillo gracias a la función \texttt{get\_all\_notes} proporcionada, la cual extrae las notas, acordes y silencios de los archivos MIDI con espacios de separación. Se iteró sobre todas las carpetas del archivo \texttt{midi\_selected} aplicando dicha función, y se almacenaron los resultados en un directorio llamado \texttt{notes}, donde cada archivo de texto corresponde a una obra musical de un compositor espeífico, dado por su prefijo. Finalmente, se creó un archivo CSV que contiene dos columnas: \texttt{notes} y \texttt{author}. La columna \texttt{notes} contiene la secuencia de notas, acordes y silencios extraídos, mientras que la columna \texttt{author} indica el compositor correspondiente.

Los conjuntos de \textbf{entrenamiento} y \textbf{prueba} se crearon utilizando la función \texttt{train\_test\_split} de la librería \texttt{sklearn.model\_selection}, con la opción de estratificación basada en la variable dependiente \texttt{author}. Se asignó un 80\% de los datos al conjunto de entrenamiento y un 20\% al conjunto de prueba, asegurando que la distribución de obras por compositor se mantuviera en ambos conjuntos.Lo anterior resultó en un conjunto de entrenamiento que contiene un total de 4050 obras.

La distribución de obras por compositor en el corpus (Figura \ref{fig:notes_per_author}) muestra que el compositor \textit{Bach} tiene una cantidad significativamente mayor de obras en comparación con otros; apróximadamente 1100 obras. Esta distribución desigual puede influir en el rendimiento de los clasificadores, ya que los modelos podrían estar sesgados hacia los compositores con más datos disponibles. Los compositores \textit{Victoria} y \textit{Schubert} tienen la menor cantidad de obras, con alrededor de 250 cada uno. Esta disparidad puede afectar la capacidad del modelo para aprender patrones representativos de estos compositores. Los demás compositores tienen cantidades intermedias de obras (450), y algo similares entre sí, lo que podría facilitar un aprendizaje más equilibrado para esos casos.

\begin{figure}
    \centering
    \begin{subfigure}[b]{\linewidth}
        \centering
        \includegraphics[width=\linewidth]{figure/notes_per_author_train.pdf}
        \caption{}
        \label{fig:notes_per_author_train}
    \end{subfigure}
    \caption{Distribución de obras por compositor en el conjunto de entrenamiento.}
    \label{fig:notes_per_author}
\end{figure}



\subsection{Inciso b)}

\subsubsection{Representación numérica de las obras.}

El conjunto de datos creado posee una estructura de texto, donde cada obra musical está representada como una secuencia de notas, acordes y silencios, acompañados de su duración. Para convertir este corpus en una representación númerica adecuada para el entrenamiento de clasificadores, se utilizó la representación TF-IDF, cuya implementación se realizó mediante la clase \texttt{TfidfVectorizer} de la librería \texttt{scikit-learn}. Los argumentos principales utilizados fueron:
\begin{itemize}
    \item \texttt{ngram\_range=(1,3)}: Considera n-gramas de longitud 1 a 3, capturando así secuencias de notas y acordes.
    \item \texttt{\detokenize{token_pattern="\b[\w.#-]+\b"}}: Quizá lo más importante, este patrón de tokenización permite capturar notas musicales con alteraciones (sostenidos y bemoles), así como acordes y silencios, con sus respectivas duraciones.
\end{itemize}
 
Se experimentó con parámetros cuyo proposito es reducir la dimensionalidad del espacio de características, como \texttt{max\_df} y \texttt{min\_df}, pero no se observaron mejoras significativas en el rendimiento de los clasificadores (de hecho, empeoraban). Por lo tanto, se optó por no utilizarlos en la versión final del modelo.

\subsubsection{Random Forest}

El primer clasificador implementado fue un \textbf{Random Forest}, utilizando la implementación de \texttt{scikit-learn}. El procedimiento para obtener el mejor modelo involucró el uso de \texttt{Optuna} para la optimización de hiperparámetros, librería que permite una búsqueda eficiente en el espacio de hiperparámetros mediante técnicas de optimización bayesiana \cite{akiba2019optuna}. Además, se empleó un seguimiento de los experimentos utilizando \texttt{MLflow} \cite{Zaharia_Accelerating_the_Machine_2018}, lo que facilitó la gestión y comparación de los diferentes modelos entrenados. El flujo de trabajo puede enlistarse de la siguiente manera:

\begin{enumerate}
    \item Definición del espacio de búsqueda de hiperparámetros, incluyendo parámetros como el número de árboles (\texttt{n\_estimators}), la profundidad máxima de los árboles (\texttt{max\_depth}), el número mínimo de muestras por hoja (\texttt{min\_samples\_leaf}) y el número mínimo de muestras para dividir un nodo (\texttt{min\_samples\_split}).
    \item Configuración de un estudio de \texttt{Optuna} para optimizar los hiperparámetros basándose en la métrica de F1-score macro obtenida mediante validación cruzada k-fold (con $k=5$).
    \item Con MLflow, se recogen los 3 mejores modelos de la búsqueda según la métrica de F1-score macro, se entrenan en el conjunto completo de entrenamiento, y se evalúan en el conjunto de prueba.
    \item Se selecciona el modelo con el mejor desempeño en el conjunto de prueba para el análisis final.
\end{enumerate}


\begin{table}[H]
\centering
\caption{Hiperparámetros optimizados para Random Forest con 20 ensayos.}
\label{tab:rf_hyperparams}
\begin{tabular}{lcc}
\toprule
\textbf{Hiperparámetro} & \textbf{Rango de búsqueda} & \textbf{Valor óptimo} \\
\midrule
\texttt{n\_estimators} & [100, 1000] (paso 100) & 400 \\
\texttt{max\_depth} & [10, 50] (paso 5) & 30 \\
\texttt{min\_samples\_split} & [2, 10] & 5 \\
\texttt{min\_samples\_leaf} & [1, 5] & 2 \\
\bottomrule
\end{tabular}
\end{table}

En la Tabla \ref{tab:rf_hyperparams} se presentan los hiperparámetros optimizados para el modelo de Random Forest, junto con sus respectivos rangos de búsqueda y los valores óptimos encontrados. Automatizar este proceso fue importante para asegurar que el modelo estuviera bien ajustado a los datos, maximizando su capacidad de generalización.


\subsubsection{XGBoost}

El segundo clasificador implementado fue \textbf{XGBoost} (Extreme Gradient Boosting), conocido por su eficiencia y rendimiento en tareas de clasificación. Al igual que con Random Forest, se utilizó \texttt{Optuna} para la optimización de hiperparámetros y \texttt{MLflow} para el seguimiento de experimentos. El flujo de trabajo fue similar al descrito anteriormente, con la definición del espacio de búsqueda de hiperparámetros específicos para XGBoost, como la tasa de aprendizaje (\texttt{learning\_rate}), el parámetro de regularización (\texttt{Gamma}) y la profundidad máxima de los árboles (\texttt{max\_depth}).

\begin{table}[H]
\centering
\caption{Hiperparámetros optimizados para XGBoost con 20 ensayos.}
\label{tab:xgb_hyperparams}
\begin{tabular}{lcc}
\toprule
\textbf{Hiperparámetro} & \textbf{Rango de búsqueda} & \textbf{Valor óptimo} \\
\midrule
\texttt{learning\_rate} & [0.01, 0.4] (paso 0.01) & 0.01 \\
\texttt{max\_depth} & [1, 10]  & 7 \\
\texttt{Gamma} & [0, 5] (paso 0.5) & 1 \\
\bottomrule
\end{tabular}
\end{table}










\newpage


\newpage
\begin{problem}{}
En la tarea anterior, leíste un ensayo de Daphne Oram. Entonces eres de los pocos afortunados que la conoce, ya que su legado como inventora, compositora y pionera de música electrónica, es (tristemente) desconocido por la mayoría.

Explora un poco más sobre ella y su legado. Puedes ver el contenido de \texttt{daphneoram.org}. Enfócate principalmente en \textit{oramics}, su invento, y describe si lo que has aprendido hasta ahora en el curso, te ayuda a entender y valorar su ingenio. Realiza un breve reporte sobre estos tópicos.
\end{problem}


Más allá de su rol como cofundadora del BBC Radiophonic Workshop, el legado más profundo y visionario de Daphne Oram es, sin duda, su invención: \textit{Oramics}. Este sistema no fue solo una herramienta musical; fue la manifestación física de los principios fundamentales del procesamiento de señales, décadas antes de que las interfaces gráficas de usuario y las Estaciones de Trabajo de Audio Digital (DAWs) se convirtieran en estándar.


\subsection{Oramics}

\noindent
El concepto central de \textit{Oramics} es la ``música dibujada''. En esencia, Oram diseñó una máquina que traducía información gráfica directamente en sonido. El sistema utilizaba una serie de tiras de película de 35mm sobre las cuales Oram dibujaba o ``pintaba''. Estas películas pasaban frente a células fotoeléctricas que leían los patrones dibujados.

La genialidad radica en cómo abstrajo los componentes del sonido en elementos visuales:

\begin{itemize}
    \item \textbf{Forma de Onda (Timbre):} El aspecto más directo. Oram dibujaba la forma de la onda (el ``grano'' del sonido) en una sección de la película. Una línea suave y ondulada (cercana a una sinusoide) produciría un tono puro, mientras que una forma de onda compleja, como un diente de sierra o una cuadrada, generaría un timbre rico en armónicos.
    \item \textbf{Tono (Pitch):} Controlado gráficamente, a menudo mediante máscaras o "plantillas" que barrían el espectro de frecuencias.
    \item \textbf{Amplitud (Volumen):} La intensidad o grosor de las líneas dibujadas controlaba la amplitud de la señal generada.
    \item \textbf{Envolvente (ADSR):} Oram también diseñaba "máscaras" que modulaban la amplitud a lo largo del tiempo, creando efectivamente envolventes de ataque, decaimiento, sostenimiento y relajación de forma puramente gráfica.
\end{itemize}

\subsection{Entendiendo Oramics a través del Curso}

Sin una comprensión del procesamiento de señales, \textit{Oramics} podría parecer casi mágico o puramente artístico. Sin embargo, lo que hemos aprendido nos permite entenderlo como un sistema de ingeniería y síntesis de audio increíblemente avanzado.

El curso nos ha enseñado que cualquier señal periódica, sin importar cuán compleja sea su forma de onda (su timbre), puede descomponerse en una suma de ondas sinusoidales simples. Oram invirtió este concepto: en lugar de descomponer, ella realizaba una \textbf{síntesis gráfica}. Al dibujar una forma de onda compleja, ella estaba definiendo implícitamente la amplitud y fase de todos los armónicos que compondrían ese sonido. Estaba, literalmente, dibujando el espectro de Fourier en el dominio del tiempo.

El ingenio de Daphne Oram no fue solo ``dibujar sonidos bonitos''. Su genialidad fue diseñar y construir un sistema físico que implementaba los principios más profundos de la teoría de señales. Ella entendió que la frecuencia, la amplitud y la forma de onda (timbre) no eran conceptos musicales abstractos, sino parámetros físicos y matemáticos de una señal que podían ser controlados y manipulados.


\textit{Oramics} demuestra que un osciloscopio y un sintetizador pueden ser, en esencia, la misma herramienta. El curso nos proporciona el lenguaje formal para apreciar que Daphne Oram no solo fue una compositora, sino también una ingeniera de señales que trabajaba con luz y película en lugar de código.





\newpage
\bibliographystyle{unsrt} % Elige un estilo (otros: abbrvnat, unsrtnat, etc.)
\bibliography{bib} % Indica el nombre de tu archivo .bib (sin la extensión)


\end{document}
